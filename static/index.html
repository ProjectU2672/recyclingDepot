<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
    </head>
    <body>
        <h4>Websocket test</h4>
        <input type="text" id="wsstring" value="ws://localhost:12345/echo">
        <input type="text" id="message">
        <div id="log"></div>
        <script>
			var logs = document.getElementById("log");
			var msgInput = document.getElementById("message");
			var wsUriInput = document.getElementById("wsstring");
			function addLog(message) {
				logs.innerHTML = "<p>" + message + "</p>" + logs.innerHTML;
			}
			msgInput.onkeydown = function(event) {
				if(event.keyCode == 13) {
					ws.send(JSON.stringify({message:msgInput.value}));
					msgInput.value = "";
				}
			};
			var ws, wsdummy = {};
			wsUriInput.onkeydown = function(event) {
				if(event.keyCode == 13) {
					ws = new WebSocket(wsUriInput.value, ["proto1", "proto2"]);
					ws.onopen = wsdummy.onopen;
					ws.onerror = wsdummy.onerror;
					ws.onmessage = wsdummy.onmessage;
				}
			};
			wsdummy.onopen = function() {
				ws.send("{\"message\":\"Hello\"}");
			};
			wsdummy.onerror = function(event) {
				console.log(event);
				addLog("Error");
			};
			wsdummy.onmessage = function(event) {
				console.log(event);
				var d = JSON.parse(event.data);
				addLog(d.message);
			};
			(function() {
				msgInput.focus();
			})();
		</script>
    </body>
</html>

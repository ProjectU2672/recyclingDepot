<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
    </head>
    <body>
        <h4>Websocket test</h4>
        <input type="text" id="message">
        <div id="log"></div>
        <script>
			var logs = document.getElementById("log");
			var msgInput = document.getElementById("message");
			var wsUriInput = document.getElementById("wsstring");
			function addLog(message) {
				logs.innerHTML = "<p>" + message + "</p>" + logs.innerHTML;
			}
			msgInput.onkeydown = function(event) {
				if(event.keyCode == 13) {
					ws.send(JSON.stringify({message:msgInput.value}));
					msgInput.value = "";
				}
			};
			var ws = new WebSocket(location.href.replace(/^http/, "ws").replace(/index\.html/, "").replace(/\/*$/, "/echo"), ["proto1", "proto2"]);
			ws.onopen = function() {
				ws.send(JSON.stringify({message:"Hello"}));
			};
			ws.onerror = function(event) {
				console.log(event);
				addLog("Error");
			};
			ws.onmessage = function(event) {
				console.log(event);
				var d = JSON.parse(event.data);
				addLog(d.message);
			};
			(function() {
				msgInput.focus();
			})();
		</script>
    </body>
</html>
